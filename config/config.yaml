pipeline:
  # Quality Gate Thresholds
  quality_gate:
    max_yaw: 20.0
    max_pitch: 20.0
    max_roll: 20.0
    blur_threshold: 100.0  # Laplacian variance
    min_face_quality: 0.5  # Nếu dùng FaceQnet/MagFace
    
  # Detection
  detection:
    model_name: "buffalo_l"  # SCRFD 10G Keypoints
    input_size: [640, 640]
    conf_threshold: 0.5
    nms_threshold: 0.4
    context_expansion_scale: 2.7  # Mở rộng bbox để thấy context (viền giấy, thiết bị, ngón tay)
    
  # Liveness Ensemble
  liveness:
    global_branch:
      model_path: "models/global_branch.onnx"  # Updated: Model mới đã train (Dec 31)
      threshold: 0.5  # Giảm từ 0.9 xuống 0.5 để phù hợp với model đã train
      weight: 0.4  # Giảm weight vì Local tốt hơn (Acc: 0.84 vs 0.80)
    local_branch:
      model_path: "models/local_branch.onnx"  # Updated: Model mới đã train (Dec 31)
      threshold: 0.5  # Giảm từ 0.8 xuống 0.5 để phù hợp với model đã train
      weight: 0.6  # Tăng weight vì Local tốt hơn (Acc: 0.84 vs 0.80)
    temporal_branch:
      enabled: false  # Tắt temporal branch vì chỉ làm việc với ảnh tĩnh
      blink_frames: 5
      min_blinks: 1
      ear_threshold: 0.25  # Eye Aspect Ratio
      weight: 0.0  # Không dùng nữa
    fusion_method: "weighted_sum"  # "weighted_sum", "soft_voting", hoặc "voting"
    final_threshold: 0.410  # Threshold tối ưu (updated)
    
  # Face Recognition (Optional - chỉ dùng nếu cần 1-1 matching)
  recognition:
    enabled: false  # Tắt nếu không cần
    model_name: "arcface_r100_v1"
    embedding_size: 512
    threshold: 0.6  # Cosine similarity threshold


